# 第14课 舵机转动

## 1.实验说明：                                                                                
在前面的机械手臂安装文档中，我们已经设置了舵机角度。舵机是一种可以非常精确地旋转的电机。目前已广泛应用于玩具车、遥控直升机、飞机、机器人等领域。在这个项目中，我们再次来学习一个舵机转动。

## 2.元件知识： 
![Img](/media/img-20230324190301.png)
舵机：舵机是一种位置伺服的驱动器，主要是由外壳、电路板、无核心马达、齿轮与位置检测器所构成。其工作原理是由接收机或者单片机发出信号给舵机，其内部有一个基准电路，产生周期为20ms，宽度为1.5ms 的基准信号，将获得的直流偏置电压与电位器的电压比较，获得电压差输出。经由电路板上的IC 判断转动方向，再驱动无核心马达开始转动，透过减速齿轮将动力传至摆臂，同时由位置检测器送回信号，判断是否已经到达定位。适用于那些需要角度不断变化并可以保持的控制系统。当电机转速一定时，通过级联减速齿轮带动电位器旋转，使得电压差为0，电机停止转动。
舵机有多种规格，但它们都有三根连接线，分别是棕色、红色、橙色(不同品牌可能有不同的颜色)。棕色为GND，红色为电源正极，橙色为信号线
![Img](/media/img-20230324190535.png)
舵机的伺服系统由可变宽度的脉冲来进行控制，橙色的控制线是用来传送脉冲的。一般而言，PWM控制舵机的基准信号周期为20ms（50Hz），理论上脉宽应在1ms到2ms之间，对应控制舵机角度是0°～180°。但是，实际上更多控制舵机的脉宽范围是0.5ms 到2.5ms，具体需要自己实际调试下。
![Img](/media/img-20230324190601.png)
经过实测，舵机的脉冲范围为0.65ms~2.5ms。180度舵机，对应的控制关系是这样的：
|高电平时间|舵机角度|基准信号周期时间（20ms）|
| :--: | :--: | :--: |
|0.65ms|0度|0.65ms高电平+19.35ms低电平|
|1.5ms|90度|1.5ms高电平+18.5ms低电平|
|2.5ms|180度|2.5ms高电平+17.5ms低电平|

舵机的规格参数：
|工作电压：|DC 4.8V〜6V|
| :--: | :--: |
|可操作角度范围：|可操作角度范围：|
|脉波宽度范围：|500→2500 μsec|
|外观尺寸：|22.9*12.2*30mm|
|空载转速：|0.12±0.01 sec/60度（DC 4.8V）  0.1±0.01 sec/60度（DC 6V）|
|空载电流：|200±20mA（DC 4.8V）  220±20mA（DC 6V）|
|停止扭力：|1.3±0.01kg·cm（DC 4.8V）  1.5±0.1kg·cm（DC 6V）|
|停止电流：|≦850mA（DC 4.8V）  ≦1000mA（DC 6V）|
|待机电流：|3±1mA（DC 4.8V）  4±1mA（DC 6V）|
|重量:|9±1g (不带舵机轴)|
|使用温度：|-30℃~60℃|

## 3.实验接线：
![Img](/media/img-20230404101458.png)

## 4.实验准备：                                                                                
（1）将Micro:bit主板正确插入4自由度机械手臂的Micro:bit 16路舵机扩展板。 
（2）外接电源。 
（3）通过Micro USB线连接Micro:bit和电脑。 
（4）打开离线版本的Mu软件。 

## 5.添加库文件：                                                                               
<span style="color: rgb(255, 76, 65);">特别注意：导入库文件前需要给Micro:bit主板上传一个.py的代码（空代码也是可以的），这里我们是以Python教程中的“**第14课 舵机转动.py**”代码为例。</span>
<br />
<br />

导入“**PCA9685\.py**”和“**servo\.py**”库文件

<br />

Mu保存文件的默认目录是“Mu_code”，它位于用户目录的根目录中。参考文献链接：https://codewith.mu/en/tutorials/1.0/files
例如，在Windows系统中，假设您的系统安装在电脑C驱动器上，则用户名为“Administrator”，那么“mu_code”目录的路径是“C:\Administrator\mu_ code”。在Linux系统上，“mu_code”目录的路径是“~/home/mu_code”           
<span style="color: rgb(115, 250, 121);">进入“mu_code”文件夹</span>。
![Img](/media/img-20230327142740.png)
我们提供的库文件“PCA9685\.py”和“servo\.py”的路径如下：
![Img](/media/img-20230327142850.png)
复制粘贴我们提供的库文件“PCA9685\.py”和“servo\.py”到“mu_code”文件夹中。复制成功后，如下图：
![Img](/media/img-20230327142937.png)
先打开Mu软件并连接Micro:bit主板到电脑，接着点击“**刷入**”按钮烧入一个程序代码到Micro:bit主板中。
![Img](/media/img-20230328094230.png)
然后点击“**文件**”按钮，就可以在“**电脑上的文件**”栏的下面方框中看到两个对应的库文件，再分别拖着库文件“PCA9685\.py”和“servo\.py”到Micro:bit主板中。
![Img](/media/img-20230328094552.png)
![Img](/media/img-20230328094506.png)
![Img](/media/img-20230328094828.png)
![Img](/media/img-20230328094905.png)
<span style="color: rgb(255, 76, 65);">特别注意: 
如果您在micro:bit板上下载了其他程序，但库文件“PCA9685\.py”和“servo\.py”程序除外。在使用Micropython编程之前，您需要将库文件导入到Micro:bit主板。
如果您始终使用相同的 Micro:bit主板进行Micropython编程，则无需多次将库文件发送到Micro:bit主板；反之，就需要再次将库文件发送到Micro:bit主板。</span> 

## 6.实验代码：                                                                                
库文件“PCA9685\.py”和“servo\.py”都添加完后，可以直接在Mu编译器上传教程中的代码，也可以手动在Mu编译器编写代码。
<span style="color: rgb(255, 76, 65);">添加代码到Mu编译器的教程与下载代码的教程请阅读“开发环境设置”文件夹中的文件“Mu Editor 编译器教程”。</span>

```
from microbit import sleep, i2c
from PCA9685 import *
from servo import *

# 使用默认地址(0x40)初始化PCA9685.
pwm = PCA9685.PCA9685(i2c)

# 设置适合舵机的频率为60hz.
pwm.set_pwm_freq(60)

print('Moving servo on channel 5, press Ctrl-C to quit...')

# 使用舵机2辅助类逐步移动通道5
s2 = Servos(i2c)
while True:
    for num in range(30 , 150):  # num值的范围从30到150
        num += 1   #num值每次加1
        s2.position(5, num) #接在通道5的舵机转动num值角度
        sleep(20)
    for num in range(30 , 150):
        num += 1
        s2.position(5, 180-num)
        sleep(20)

```
## 7.实验结果：                                                                                
按照之前的方式将程序下载至Micro: bit主板，利用外接电源供电。上电后，按一下Micro: bit主板上的复位按钮，4自由度机械手臂的舵机2（底座转动舵机）将从右边向左边转动，再从左边向右边转动，循环进行。








