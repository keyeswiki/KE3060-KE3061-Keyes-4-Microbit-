# 第17课 双摇杆控制4自由度机械手臂

## 1.实验说明：                                                                                 
前面课程中我们学习了舵机的基本原理与应用，同时也学习了读取摇杆的值。则在这一课程中，我们将这两个实验结合起来，实现通过利用两个摇杆模块，来控制4自由度机械手臂实现各种运动。
控制时我们先设置开机的姿势；摇杆模块控制4自由度机械手臂的如下表格：
**初始化（即舵机初始角度）**
|舵机4（左侧舵机）：120°|舵机1（右侧舵机）：60°|
| :--: | :--: |
|**舵机2（底座转动舵机）：90°**|**舵机3（爪子处舵机）：60°**|

**左、右摇杆模块控制4自由度机械手臂**
|左摇杆|舵机|右摇杆|舵机|
| :--: | :--: | :--: | :--: |
|x<100|舵机2（底座转动舵机）的角度会逐渐减到30度（即：左摇杆摆到后面时，控制机械手臂转动的舵机2往右转，转到30度就停下。）|y2<100|舵机1（右侧舵机）的角度会逐渐增大到180°（即：右摇杆摆到右边时，连接舵机1的小摆杆往上前摆。）|
|x>900|舵机2（底座转动舵机）逐渐加到150度（即：左摇杆摆到前面时，控制机械手臂转动的舵机2往左转，转到150度就停下。）|y2>800|舵机1（右侧舵机）的角度会逐渐减少到0°（即：右摇杆摆到左边时，连接舵机1的小摆杆往后下摆。）|
|y1>900|舵机4（左侧舵机）的角度会逐渐增加到180°（即：左摇杆摆到左边时，连接舵机4的大摆杆往后摆。）|z=1| 舵机3（爪子处舵机）的角度为180°（即：按住右摇杆的按钮，机械爪打开。） |
|y1<100|舵机4（左侧舵机）的角度会逐渐减少到35°（即：左摇杆摆到右边时，连接舵机4的大摆杆往前摆。）|z=0| 舵机3（爪子处舵机）的角度为60°（即：松开右摇杆的按钮，机械爪关闭。） |

## 2.实验接线： 
|舵机1（右侧舵机）|Micro:bit 16路舵机扩展板|
| :--: | :--: |
|棕线|G|
|红线|V|
|橙线|S(4)|


|舵机2（底座转动舵机）|Micro:bit 16路舵机扩展板|
| :--: | :--: |
|棕线|G|
|红线|V|
|橙线|S(5)|


|舵机3（爪子处舵机）|Micro:bit 16路舵机扩展板|
| :--: | :--: |
|棕线|G|
|红线|V|
|橙线|S(6)|


|舵机4（左侧舵机）|Micro:bit 16路舵机扩展板|
| :--: | :--: |
|棕线|G|
|红线|V|
|橙线|S(7)|


|左边摇杆模块(引脚)|Micro:bit 16路舵机扩展板|
| :--: | :--: |
|Y|P0|
|X|P1|
|V|+3V|
|G|GND|


|右边摇杆模块(引脚)|Micro:bit 16路舵机扩展板|
| :--: | :--: |
|Y|P2|
|B|P13|
|V|P14|
|G|P15|

![Img](/media/img-20230407101416.png)

## 3.实验准备：                                                                                 
（1）将Micro:bit主板正确插入4自由度机械手臂的Microbit 16路舵机扩展板。 
（2）外接电源。 
（3）通过Micro USB线连接Micro:bit和电脑。 
（4）打开离线版本或Web版本的Makecode。 
<span style="color: rgb(255, 169, 0);">如果选择通过导入Hex文件来加载项目，则无需手动添加pca9685扩展库。</span>
<span style="color: rgb(255, 76, 65);">如果选择手动拖动代码，则首先需要添加pca9685扩展库（详细步骤请参考“1.开发环境配置”文件）。</span>

## 4.实验代码：
可以直接加载我们提供的程序，也可以自己通过拖动程序块来编写程序程序，操作步骤如下：
**（1）添加库文件**
打开MakeCode，先点击右上角的齿轮图标![Img](/media/img-20230324110032.png)（设置），再点击“扩展”。
![Img](/media/img-20230417131743.png)

或者单击“**高级**”上的“**扩展**”。
![Img](/media/img-20230417131804.png)

在搜索框中输入链接：`https://github.com/keyestudio2019/pxt-pca9685-smallest`，然后单击搜索。 
单击搜索结果pca9685以下载并安装。 该过程可能需要几秒钟。
![Img](/media/img-20230417131953.png)

安装完成后，你可以在左侧找到pca9685的扩展库。
![Img](/media/img-20230417132047.png)
![Img](/media/img-20230417132114.png)
<span style="color: rgb(255, 76, 65);">注意：添加到项目中的扩展库仅对该项目有效，而不会出现在其他项目中。 因此，当你创建新项目代码时，需要再次添加pca9685扩展库。</span>
**（2）寻找代码块**
![Img](/media/img-20230417141032.png)
![Img](/media/img-20230417141126.png)
![Img](/media/img-20230417135305.png)
![Img](/media/img-20230417154110.png)
![Img](/media/img-20230417154431.png)
![Img](/media/img-20230417154542.png)
![Img](/media/img-20230417135353.png)
![Img](/media/img-20230417152104.png)
![Img](/media/img-20230417155308.png)
![Img](/media/img-20230417151311.png)
![Img](/media/img-20230417155524.png)
![Img](/media/img-20230417155634.png)

**（3）完整代码程序**
由于代码比较长，请打开我们提供的示例代码“**第17课：双摇杆控制4自由度机械手臂.hex**”查看，如下图位置：
![Img](/media/img-20230327110825.png)

## 5.实验结果：                                                                                
按照之前的方式将程序下载至Micro: bit主板，利用外接电源供电。上电后，按一下Micro: bit主板上的复位按钮，4自由度机械手臂将处于初始位置，摇动左右两个摇杆模块（左摇杆沿着X轴和Y轴方向摇动；右摇杆沿着Y轴方向摇动及按下、松开右摇杆按钮），即可控制4自由度机械手臂实现各种运动。





